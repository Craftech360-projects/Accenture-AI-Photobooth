I have just completed the UI of my new photobooth application. Now I need help with integrating the backend functionalities. First I need to have a state management that holds user selected gender in gender_screen.dart and user selected category in category_screen.dart. I have two main categories in my app: AI Transformation and BG Removal. I am sharing a reference project which is also a very similar photobooth application like this. And we have to follow the exact same flow for AI transformation and there is a slight change in the flow of BG Removal.

Let me explain the flow for AI Transformation. First user will choose their gender and AI Transformation and navigates to capture_screen.dart. Here user will take a picture and we have to store that captured image to "accenture_images" bucket first and we have to save that image url in the "image_url" column of "accenture_images" table and we have to store a random uuid to "unique_id" column

The table definition:
create table public.accenture_images (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  unique_id uuid null default gen_random_uuid (),
  image_url text null,
  output text null,
  characterimage text null,
  email text null,
  name text null,
  gender text null,
  constraint accenture_images_pkey primary key (id)
) TABLESPACE pg_default;

In "accenture_themes" bucket I have saved themes for male and female. Mainly we have 5 themes:
1. scientist
2. psychiatrist
3. influencer
4. entrepreneur
5. future_consultant

In each theme I have 5 images (01.png to 05.png).

Example paths:
https://ozkbnimjuhaweigscdby.supabase.co/storage/v1/object/public/accenture_themes/male/scientist/male_01.png
https://ozkbnimjuhaweigscdby.supabase.co/storage/v1/object/public/accenture_themes/female/future_consultant/female_05.png

Based on user gender we will fetch a random image from a random theme and we will save it to "characterimage" column of accenture_images table. And after that we will send both the images to docker image in Runpod. The docker image will do the faceswap and it will save back the output image in "output" column of accenture_images table. And in flutter app we will poll and fetch the image from supabase. This is the flow for AI Transformation. The reference project has this same implementation.

And for the BG Removal:
In the reference project you can see I am using gemini 2.5 flash. For background removal also we have to use the exact same approach. The only change is in prompt.
What we have to do here is first user will take their picture and we will save it to supabase like we did for AI Transformation. After that, from "accenture_backgrounds" supabase bucket we have to fetch a random background image. I have 3 images saved by the names:
https://ozkbnimjuhaweigscdby.supabase.co/storage/v1/object/public/accenture_backgrounds/background_01.png [background_02.png and background_03.png]

Then we have to send the user image and the random background image and we will simply change the background of user image with the random background image. And when we get the response from gemini we will save it to supabase first and we will display in app. Save the random background selected to "characterimage" column of table as reference.